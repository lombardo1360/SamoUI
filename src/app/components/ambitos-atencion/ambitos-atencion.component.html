<div class="ambitos-container">
  <div class="header">
    <h2>츼mbitos de Atenci칩n M칠dica</h2>
    <p class="subtitle">Seleccione los 치mbitos que desea incluir</p>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando 치mbitos de atenci칩n...</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-icon">丘멆잺</div>
    <p class="error-message">{{ error }}</p>
    <button class="retry-button" (click)="retry()">Reintentar</button>
  </div>

  <!-- Lista de checkboxes -->
  <div *ngIf="!isLoading && !error" class="checkbox-container">
    
    <!-- Header con seleccionar todos -->
    <div class="selection-header">
      <label class="checkbox-item select-all">
        <input 
          type="checkbox" 
          [checked]="isAllSelected()"
          [class.indeterminate]="isIndeterminate()"
          (change)="toggleSelectAll()">
        <span class="checkmark"></span>
        <span class="label-text">
          Seleccionar todos ({{ getSelectedCount() }}/{{ ambitos.length }})
        </span>
      </label>
    </div>

    <!-- Lista de 치mbitos -->
    <div class="ambitos-list">
      <label 
        *ngFor="let ambito of ambitos; trackBy: trackByAmbitoId" 
        class="checkbox-item">
        <input 
          type="checkbox" 
          [checked]="ambito.selected"
          (change)="onSelectionChange(ambito)">
        <span class="checkmark"></span>
        <span class="label-text">{{ ambito.name }}</span>
        <span *ngIf="ambito.id" class="ambito-id">ID: {{ ambito.id }}</span>
      </label>
    </div>

    <!-- Resumen de selecci칩n -->
    <div *ngIf="getSelectedCount() > 0" class="selection-summary">
      <h3>Elementos Seleccionados ({{ getSelectedCount() }}):</h3>
      <div class="selected-list">
        <span 
          *ngFor="let ambito of ambitos | slice:0:10; let last = last" 
          [class.selected-item]="ambito.selected">
          <span *ngIf="ambito.selected">{{ ambito.name }}</span><span *ngIf="ambito.selected && !last">, </span>
        </span>
        <span *ngIf="getSelectedCount() > 10" class="more-items">
          ... y {{ getSelectedCount() - 10 }} m치s
        </span>
      </div>
    </div>

    <!-- Estado sin datos -->
    <div *ngIf="ambitos.length === 0" class="no-data-state">
      <div class="no-data-icon">游늶</div>
      <p>No se encontraron 치mbitos de atenci칩n m칠dica</p>
    </div>
  </div>
</div>
