<div class="recaudos-container">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Sistema de Recaudos</h1>
      <p class="hero-subtitle">Gestiona recaudos, √°mbitos de atenci√≥n, excepciones y programas de convenio de manera eficiente</p>
    </div>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando recaudos, √°mbitos, excepciones y programas...</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p class="error-message">{{ error }}</p>
    <button class="retry-button" (click)="retry()">Reintentar</button>
  </div>

  <!-- Main Grid Layout -->
  <div *ngIf="!isLoading && !error" class="main-grid">
    
    <!-- Sidebar con Recaudos -->
    <div class="sidebar-section">
      <div class="section-card">
        <div class="card-header">
          <h2 class="card-title">Recaudos Disponibles</h2>
          <span class="badge">{{ recaudos.length }}</span>
        </div>
        
        <div class="dropdown-wrapper">
          <select 
            id="recaudos-select"
            class="modern-select"
            (change)="onRecaudoSelect($event)"
            [disabled]="recaudos.length === 0">
            
            <option value="">Seleccionar recaudo...</option>
            <option 
              *ngFor="let recaudo of recaudos; let i = index" 
              [value]="recaudo.id">
              {{ recaudo.name }}
            </option>
          </select>
        </div>

        <!-- Info del recaudo seleccionado -->
        <div *ngIf="selectedRecaudo" class="selected-recaudo-info">
          <div class="info-header">
            <h3>{{ selectedRecaudo.name || selectedRecaudo.nombre }}</h3>
            <span class="status-badge" [class.active]="selectedRecaudo.estado" [class.inactive]="!selectedRecaudo.estado">
              {{ selectedRecaudo.estado ? 'Activo' : 'Inactivo' }}
            </span>
          </div>
          <div class="info-details">
            <div class="detail-item">
              <span class="label">ID:</span>
              <span class="value">{{ selectedRecaudo.id }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Operaci√≥n:</span>
              <span class="value">{{ selectedRecaudo.operacionId }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Area con Cards -->
    <div class="content-section">
      
      <!-- Card de √Åmbitos -->
      <div class="content-card ambitos-card">
        <div class="card-header">
          <div class="header-content">
            <h2 class="card-title">√Åmbitos de Atenci√≥n</h2>
            <div class="selection-counter">
              {{ getSelectedAmbitosCount() }}/{{ ambitos.length }}
            </div>
          </div>
          
          <label class="toggle-all">
            <input 
              type="checkbox" 
              [checked]="isAllAmbitosSelected()"
              [class.indeterminate]="isAmbitosIndeterminate()"
              (change)="toggleSelectAllAmbitos()">
            <span class="toggle-checkmark"></span>
            <span class="toggle-text">Seleccionar todos</span>
          </label>
        </div>

        <div class="options-grid">
          <label 
            *ngFor="let ambito of ambitos; trackBy: trackByAmbitoId" 
            class="option-card"
            [class.selected]="ambito.selected">
            <input 
              type="checkbox" 
              [checked]="ambito.selected"
              (change)="onAmbitoSelectionChange(ambito)">
            <div class="option-content">
              <span class="option-checkmark"></span>
              <span class="option-text">{{ ambito.name }}</span>
            </div>
          </label>
        </div>

        <div *ngIf="getSelectedAmbitosCount() > 0" class="selection-summary ambitos-summary">
          <div class="summary-header">
            <span class="summary-icon">‚úì</span>
            <span class="summary-title">{{ getSelectedAmbitosCount() }} √°mbitos seleccionados</span>
          </div>
        </div>
      </div>

      <!-- Card de Excepciones -->
      <div class="content-card excepciones-card">
        <div class="card-header">
          <div class="header-content">
            <h2 class="card-title">Otras Excepciones</h2>
            <div class="selection-counter">
              {{ getSelectedExcepcionesCount() }}/{{ excepciones.length }}
            </div>
          </div>
          
          <label class="toggle-all">
            <input 
              type="checkbox" 
              [checked]="isAllExcepcionesSelected()"
              [class.indeterminate]="isExcepcionesIndeterminate()"
              (change)="toggleSelectAllExcepciones()">
            <span class="toggle-checkmark"></span>
            <span class="toggle-text">Seleccionar todas</span>
          </label>
        </div>

        <div class="options-grid">
          <label 
            *ngFor="let excepcion of excepciones; trackBy: trackByExcepcionId" 
            class="option-card"
            [class.selected]="excepcion.selected">
            <input 
              type="checkbox" 
              [checked]="excepcion.selected"
              (change)="onExcepcionSelectionChange(excepcion)">
            <div class="option-content">
              <span class="option-checkmark"></span>
              <span class="option-text">{{ excepcion.name }}</span>
            </div>
          </label>
        </div>

        <div *ngIf="getSelectedExcepcionesCount() > 0" class="selection-summary excepciones-summary">
          <div class="summary-header">
            <span class="summary-icon">‚úì</span>
            <span class="summary-title">{{ getSelectedExcepcionesCount() }} excepciones seleccionadas</span>
          </div>
        </div>
      </div>

      <!-- Card de Programas -->
      <div class="content-card programas-card">
        <div class="card-header">
          <div class="header-content">
            <h2 class="card-title">Programas de Convenio</h2>
            <div class="selection-counter">
              {{ getSelectedProgramasCount() }}/{{ programas.length }}
            </div>
          </div>
          
          <label class="toggle-all">
            <input 
              type="checkbox" 
              [checked]="isAllProgramasSelected()"
              [class.indeterminate]="isProgramasIndeterminate()"
              (change)="toggleSelectAllProgramas()">
            <span class="toggle-checkmark"></span>
            <span class="toggle-text">Seleccionar todos</span>
          </label>
        </div>

        <div class="options-grid">
          <label 
            *ngFor="let programa of programas; trackBy: trackByProgramaId" 
            class="option-card"
            [class.selected]="programa.selected">
            <input 
              type="checkbox" 
              [checked]="programa.selected"
              (change)="onProgramaSelectionChange(programa)">
            <div class="option-content">
              <span class="option-checkmark"></span>
              <span class="option-text">{{ programa.name }}</span>
            </div>
          </label>
        </div>

        <div *ngIf="getSelectedProgramasCount() > 0" class="selection-summary programas-summary">
          <div class="summary-header">
            <span class="summary-icon">‚úì</span>
            <span class="summary-title">{{ getSelectedProgramasCount() }} programas seleccionados</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Section -->
    <div class="action-section">
      <!-- Botones de Acci√≥n -->
      <div class="action-buttons">
        <!-- Bot√≥n de A√±adir -->
        <button 
          class="action-button add-button"
          [disabled]="!selectedRecaudo"
          (click)="addConfiguration()">
          <span class="button-content">
            <span class="button-icon">‚ûï</span>
            <span class="button-text">A√±adir</span>
          </span>
        </button>

        <!-- Bot√≥n de Guardar -->
        <button 
          class="action-button save-button"
          [disabled]="!canSave()"
          [class.loading]="isSaving"
          (click)="guardarConfiguracion()">
          
          <span *ngIf="!isSaving" class="button-content">
            <span class="button-icon">üíæ</span>
            <span class="button-text">Guardar</span>
          </span>
          
          <span *ngIf="isSaving" class="button-content loading-content">
            <span class="loading-spinner"></span>
            <span class="button-text">Guardando...</span>
          </span>
        </button>

        <!-- Bot√≥n de Limpiar -->
        <button 
          class="action-button clear-button"
          [disabled]="!hasSelections()"
          (click)="clearAllSelections()">
          <span class="button-content">
            <span class="button-icon">üóëÔ∏è</span>
            <span class="button-text">Limpiar</span>
          </span>
        </button>
      </div>

      <!-- Messages Section -->
      <div class="messages-section">
        <!-- Mensaje de √©xito -->
        <div *ngIf="saveSuccess" class="success-message">
          <span class="success-icon">‚úÖ</span>
          <span class="success-text">Configuraci√≥n guardada exitosamente</span>
        </div>

        <!-- Mensaje de error espec√≠fico para guardar -->
        <div *ngIf="error && !isLoading" class="error-message-inline">
          <span class="error-icon">‚ö†Ô∏è</span>
          <span class="error-text">{{ error }}</span>
        </div>

        <!-- Informaci√≥n de ayuda -->
        <div class="help-info" *ngIf="!selectedRecaudo">
          <span class="help-icon">üí°</span>
          <span class="help-text">Seleccione un recaudo para poder guardar la configuraci√≥n</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado sin datos -->
  <div *ngIf="!isLoading && !error && recaudos.length === 0" class="empty-state">
    <div class="empty-icon">üìã</div>
    <h3>No hay recaudos disponibles</h3>
    <p>No se encontraron recaudos para mostrar en este momento.</p>
  </div>
</div>
